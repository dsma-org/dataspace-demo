<!DOCTYPE html>
<html>
<head>
    <title>IoP Dataset Finder (Prototype)</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        input[type="radio"]:checked + label {
            color: rgb(0, 84, 159);
        }
        .selectable {
            display: inline-flex;
            justify-content: center; 
            align-items: center;
            width: 42px;
            height: 20px; 
            margin: 2px;
            padding: 4px;
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            border: 1px solid #000000;
        }
        .selected {
            background-color: #eaee00; 
        }
        .search-results {
            padding-left: 25px; 
        }
        .search-results p {
            margin-bottom: 2px;
        }
        .search-list li {
            word-wrap: break-word;
        }
        h2 {
            color: rgb(0, 84, 159); 
        }

        .search-bar {
            text-align: center;
            margin-top: 50px;
        }

        .search-bar input[type="text"] {
            width: 80%; 
            max-width: 800px;
            padding: 10px; 
            font-size: 18px; 
            border: 1px solid #ccc; 
            border-radius: 4px;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1); 
        }

        .search-bar button[type="submit"] {
            padding: 10px 20px; 
            font-size: 18px; 
            background-color: #4285f4; 
            color: #fff; 
            border: none;
            border-radius: 4px; 
            cursor: pointer; 
            transition: background-color 0.3s ease; 
        }

        .search-bar button[type="submit"]:hover {
            background-color: #357ae8; 
        }

        .how-to-use-content {
            display: none;
        }
        .how-to-use-toggle {
            cursor: pointer;
        }

        .statistics-button {
            /* position: fixed; */
            position: absolute;
            top: 20px;
            right: 20px;
            height: 22px;
            width: 80px; 
            padding: 0px;
            font-size: 18px;
            background-color: rgb(0, 84, 159);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .statistics-button:hover {
            background-color: #357ae8;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        
        <h2 class="text-center" style="margin-top: 30px; font-size: 50px;">IoP Dataset Finder (Prototype)</h2>
        <div class="text-center" style="font-size: 18px; margin-top: 10px;">
            <strong>Total Projects: {{ app.config['NumPROJECTS'] }}</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <strong>Total Datasets: {{ app.config['NumDATASETS'] }}</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <strong>Total Links/PIDs: <a href="{{ url_for('links') }}" class="link-value">{{ app.config['NumLinksPids'] }}</a></strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <strong>Total Coscine: <a href="{{ url_for('coscine_links') }}" class="link-value">{{ app.config['NumCoscine'] }}</a></strong></span>

        </div>

        <div class="row">

            <div class="col-md-12 text-center search-bar" style="margin-top: 20px;">
                <form method="post" action="/click">
                    <input type="text" name="word" value="{{word}}">
                    <button type="submit" name="click_button" style="background-color: rgb(0, 84, 159);">Search</button>
                    <button type="submit" id="execute-button" formaction="/reset" style="background-color: rgb(114, 135, 153);">Reset</button>
                </form>
            </div>

            

            <div class="col-md-2 search-bar">

                <form id="sortForm" action="/sortX" method="GET">
                    <p><strong>Sort results by:</strong>
                        <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                            {% for option in app.config['sorting_list'] %}
                                <option value="{{ option }}" {% if session['sort_by'] == option %} selected {% endif %}>{{ option }}</option>
                            {% endfor %}
                        </select>
                        <select name="sort_order" id="sort_order" onchange="this.form.submit()">
                            <option value="ascending" {% if session['sort_order'] == 'ascending' %} selected {% endif %}>Ascending</option>
                            <option value="descending" {% if session['sort_order'] == 'descending' %} selected {% endif %}>Descending</option>
                        </select>
                    </p>
                </form>



                <label><strong>Filter Workstreams:</strong></label>
                <form action="/andor" method="POST">
                    <input type="radio" id="andCheckbox" name="logicOperator" value="AND" {% if session['logicOperator'] == 'AND' %}checked{% endif %} onchange="this.form.submit()">
                    <label for="andCheckbox">AND</label>
                    <input type="radio" id="orCheckbox" name="logicOperator" value="OR" {% if session['logicOperator'] == 'OR' %}checked{% endif %} onchange="this.form.submit()">
                    <label for="orCheckbox">OR</label>
                </form>
                
                <form method="post" action="/dropdown" id="dropdown-form">
                    {% for workstream in app.config['WORKSTREAMS'] %}
                    <div class="selectable {% if workstream in selected_WS %}selected{% endif %}" onclick="toggleSelection(this)" data-value="{{ workstream }}">
                        {{ workstream }}
                    </div>
                    {% if loop.index % 3 == 0 %}
                        <br> 
                    {% endif %}
                    {% endfor %}
                </form>
                

                {% endif %}
            </div>

            <div class="col-md-10 search-results">
                {% block content %}{% endblock %}
            </div>
        </div>

    </div>

    <footer class="bg-light py-5">
        
        <div class="container">
            <p><strong>How to use:</strong> <span class="how-to-use-toggle">&#9432;</span></p>
            <div class="how-to-use-content">
                <strong>Keyword Search:</strong> Enter the desired keywords or phrases into the search bar. Separate multiple terms with commas to trigger an automatic "OR" search function, broadening the search scope.<br>
                <strong>Executing Search:</strong> Click the "Search" button after inputting the search criteria to initiate the search process.<br>
                <strong>Refining Results with Workstream Filters:</strong> Select workstreams by clicking on them to narrow down the search results. Combine the selected workstreams by clicking on "AND" or "OR" for precise refinement.<br>
                <strong>Sorting Options:</strong> Arrange the results according to the preferences using the sorting dropdown menu on the left-hand side. Please note that after changing the sorting or applying filters, the search must be executed again to update the results.<br>
                <strong>Resetting Search:</strong> To start anew, click the "Reset" button to clear all search parameters.<br>
                <strong>Contacting Project-Owner:</strong> To contact the Project-Owner, click in "Contact Project-Owner". This functionality remains operational even if Personal data is not disclosed.<br>
            </div>
            <br><p>This website uses cookies and collects and processes your data. Please read our <a href="/privacy_policy" target="_blank">data privacy policy</a>.</p>


            <p>Develop Version 31.10.2024 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Last database update: {{ last_updated }}</p>
            <a href="/imprint" target="_blank">Imprint</a>
            


            <form action="/logout" method="POST" class="logout-form">
                <button type="submit" class="btn btn-link">Logout</button>
            </form>

            <div class="col-md-12 text-center">
                <img src="{{ url_for('static', filename='SE.DSMA.IoP.Logo2.png') }}" alt="Combined Logo" class="img-fluid" style="height: auto; width: 60%;" usemap="#bannerMap">
            </div>
        </div>

            </div>
        </div>
    </footer>
    
    <button class="statistics-button" onclick="window.location.href='/statistics'">Statistics</button>

    <script>        
        function toggleSelection(entry) {
            entry.classList.toggle('selected');
            const selectedNumbers = [...document.querySelectorAll('.selectable.selected')].map(entry => entry.dataset.value);
            const formData = new FormData();
            for (const number of selectedNumbers) {
                formData.append('numbers', number);
            }
            fetch('/dropdown', {
                method: 'POST',
                body: formData
            });
        } 


        document.addEventListener('DOMContentLoaded', function() {
            const toggleButton = document.querySelector('.how-to-use-toggle');
            const content = document.querySelector('.how-to-use-content');

            toggleButton.addEventListener('click', function() {
                content.style.display = content.style.display === 'block' ? 'none' : 'block';
            });
        });

        document.getElementById('scroll-to-top').addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

    </script>

</body>
</html>
